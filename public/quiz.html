<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="styles.css">
  <meta charset="UTF-8" />
  <title>Play – Elite Ball Knowledge</title>
</head>
<body>
<button class="btn" onclick="window.location.href='index.html'">⬅ Home</button>
<button onclick="window.location.href='index.html'"
        style="
          margin-bottom: 15px;
          padding: 10px 20px;
          font-size: 16px;
          cursor: pointer;
          border-radius: 6px;
          border: none;
          background-color: #222;
          color: white;
          font-weight: bold;
        ">
  ⬅ Home
</button>


  <h1 id="page-title">Elite Ball Knowledge</h1>
  <div id="content">
    Loading...
  </div>

  <script>
    // running totals for this session
    let correctCount = 0;
    let totalCount = 0;
    let currentCorrectOption = null;

    function getCategoryFromQuery() {
      const params = new URLSearchParams(window.location.search);
      const cat = params.get('category') || 'NFL';
      return cat.toUpperCase();
    }

    async function loadQuestion() {
      const category = getCategoryFromQuery();
      const contentDiv = document.getElementById('content');
      document.getElementById('page-title').innerText =
        category + ' Quiz – Elite Ball Knowledge';

      // Only NFL is live for now
      if (category !== 'NFL') {
        contentDiv.innerHTML = `<p>${category} quizzes are under construction. Check back soon!</p>
                                <p><a href="index.html">← Back to categories</a></p>`;
        return;
      }

      try {
        const res = await fetch(`/api/questions/random?category=${encodeURIComponent(category)}`);
        const data = await res.json();

        if (!data.ok) {
          contentDiv.innerHTML = `<p>Error: ${data.error}</p>
                                  <p><a href="index.html">← Back to categories</a></p>`;
          return;
        }

        const q = data.question;
        currentCorrectOption = q.correct_option; // <-- from server

        // build the question UI; include current score so it persists between questions
        contentDiv.innerHTML = `
          <h2>${q.question_text}</h2>
          <ol type="A">
            <li data-option="A">${q.option_a}</li>
            <li data-option="B">${q.option_b}</li>
            <li data-option="C">${q.option_c}</li>
            <li data-option="D">${q.option_d}</li>
          </ol>
          <p id="result"></p>
          <div id="score" style="margin-top:20px; font-size:18px; font-weight:bold;">
            Score: ${correctCount} correct out of ${totalCount}
          </div>
          <button id="next-btn" style="display:none;">Next Question</button>
          <p><a href="index.html">← Back to categories</a></p>
        `;

        const listItems = contentDiv.querySelectorAll('li[data-option]');
        const resultEl = document.getElementById('result');
        const nextBtn = document.getElementById('next-btn');
        let answered = false;

        listItems.forEach(li => {
          li.style.cursor = 'pointer';
          li.addEventListener('click', () => {
            if (answered) return;
            answered = true;

            const selected = li.dataset.option;
            totalCount++;

            if (selected === currentCorrectOption) {
              correctCount++;
              resultEl.textContent = 'Correct!';
              resultEl.style.color = 'green';
            } else {
              resultEl.textContent = `Wrong! Correct answer: ${currentCorrectOption}`;
              resultEl.style.color = 'red';

              // underline the correct one
              const correctLi = contentDiv.querySelector(
                `li[data-option="${currentCorrectOption}"]`
              );
              if (correctLi) {
                correctLi.style.textDecoration = 'underline';
              }
            }

            // bold the selected option
            li.style.fontWeight = 'bold';

            // update score display
            updateScore();

            // show next button
            nextBtn.style.display = 'inline-block';
          });
        });

        nextBtn.addEventListener('click', loadQuestion);
      } catch (err) {
        console.error(err);
        contentDiv.innerHTML = `<p>Unexpected error loading question.</p>
                                <p><a href="index.html">← Back to categories</a></p>`;
      }
    }

    function updateScore() {
      const scoreEl = document.getElementById('score');
      if (!scoreEl) return;
      scoreEl.textContent = `Score: ${correctCount} correct out of ${totalCount}`;
    }

    loadQuestion();
  </script>
</body>
</html>
